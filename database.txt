CREATE TABLE MURICA_USER
(
    ID CHAR(6) NOT NULL,
    NAME VARCHAR2(50) NOT NULL,
    EMAIL VARCHAR2(320) NOT NULL,
    PASSWORD VARCHAR2(255) NOT NULL,
    BIRTH_DATE DATE NOT NULL,
    CONSTRAINT MURICA_USER_PK PRIMARY KEY (ID) ENABLE
);

CREATE TABLE MURICA_PROGRAMME
(
    NAME VARCHAR2(50) NOT NULL,
    TYPE VARCHAR2(10) NOT NULL,
    NO_TERMS INTEGER NOT NULL,
    CONSTRAINT MURICA_PROGRAMME_PK PRIMARY KEY (NAME, TYPE) ENABLE
);

COMMENT ON COLUMN MURICA_PROGRAMME.TYPE IS 'Bsc/Msc/etc';

CREATE TABLE MURICA_STUDENT
(
    USER_ID CHAR(6) NOT NULL,
    PROGRAMME_NAME VARCHAR2(50) NOT NULL,
    PROGRAMME_TYPE VARCHAR2(10) NOT NULL,
    START_TERM CHAR(9) NOT NULL,
    CONSTRAINT MURICA_STUDENT_PK PRIMARY KEY (USER_ID, PROGRAMME_NAME, PROGRAMME_TYPE) ENABLE
);

ALTER TABLE MURICA_STUDENT
    ADD CONSTRAINT MURICA_STUDENT_FK1 FOREIGN KEY (USER_ID)
        REFERENCES MURICA_USER (ID)
            ON DELETE CASCADE ENABLE;

ALTER TABLE MURICA_STUDENT
    ADD CONSTRAINT MURICA_STUDENT_FK2 FOREIGN KEY (PROGRAMME_NAME, PROGRAMME_TYPE)
        REFERENCES MURICA_PROGRAMME (NAME, TYPE)
            ENABLE;

CREATE TABLE MURICA_ADMIN
(
    USER_ID CHAR(6) NOT NULL,
    CONSTRAINT MURICA_ADMIN_PK PRIMARY KEY (USER_ID) ENABLE
);

ALTER TABLE MURICA_ADMIN
    ADD CONSTRAINT MURICA_ADMIN_FK1 FOREIGN KEY (USER_ID)
        REFERENCES MURICA_USER (ID)
            ON DELETE CASCADE ENABLE;

CREATE TABLE MURICA_SUBJECT
(
    ID CHAR(6) NOT NULL,
    NAME VARCHAR2(50) NOT NULL,
    APPROVAL NUMBER(1) NOT NULL,
    CREDIT INTEGER NOT NULL,
    TYPE VARCHAR2(20) NOT NULL,
    CONSTRAINT MURICA_SUBJECT_PK PRIMARY KEY (ID) ENABLE
);

CREATE TABLE MURICA_ROOM
(
    ID VARCHAR2(20) NOT NULL,
    CAPACITY NUMBER(3) NOT NULL,
    CONSTRAINT MURICA_ROOM_PK PRIMARY KEY (ID) ENABLE
);

CREATE TABLE MURICA_COURSE
(
    SUBJECT_ID CHAR(6) NOT NULL,
    ID CHAR(6) NOT NULL,
    CAPACITY NUMBER(3) NOT NULL,
    SCHEDULE CHAR(13) NOT NULL,
    TERM CHAR(9) NOT NULL,
    ROOM_ID VARCHAR(20) NOT NULL,
    CONSTRAINT MURICA_COURSE_PK PRIMARY KEY (SUBJECT_ID, ID) ENABLE
);

ALTER TABLE MURICA_COURSE
    ADD CONSTRAINT MURICA_COURSE_FK1 FOREIGN KEY(ROOM_ID)
        REFERENCES MURICA_ROOM(ID) ENABLE;

ALTER TABLE MURICA_COURSE
    ADD CONSTRAINT MURICA_COURSE_FK2 FOREIGN KEY(SUBJECT_ID)
        REFERENCES MURICA_SUBJECT(ID) ENABLE;

CREATE TABLE MURICA_EXAM
(
    SUBJECT_ID CHAR(6) NOT NULL,
    ID CHAR(6) NOT NULL,
    START_TIME DATE NOT NULL,
    END_TIME DATE NOT NULL,
    TEACHER_ID CHAR(6) NOT NULL,
    ROOM_ID VARCHAR2(20),
    CONSTRAINT EXAM_PK PRIMARY KEY (SUBJECT_ID, ID) ENABLE
);

ALTER TABLE MURICA_EXAM
    ADD CONSTRAINT MURICA_EXAM_FK1 FOREIGN KEY (TEACHER_ID)
        REFERENCES MURICA_USER (ID) ENABLE;

ALTER TABLE MURICA_EXAM
    ADD CONSTRAINT MURICA_EXAM_FK2 FOREIGN KEY (ROOM_ID)
        REFERENCES MURICA_ROOM (ID) ENABLE;

CREATE TABLE MURICA_MESSAGE
(
    MESSAGE_DATE DATE NOT NULL,
    CONTENT CLOB NOT NULL ,
    SUBJECT VARCHAR2(256) NOT NULL ,
    USER_ID CHAR(6) NOT NULL ,
    CONSTRAINT MURICA_MESSAGE_PK PRIMARY KEY (MESSAGE_DATE) ENABLE
);

ALTER TABLE MURICA_MESSAGE
    ADD CONSTRAINT MURICA_MESSAGE_UNIQUE UNIQUE (MESSAGE_DATE, SUBJECT, USER_ID);
ALTER TABLE MURICA_MESSAGE
    ADD CONSTRAINT MURICA_MESSAGE_FK1 FOREIGN KEY(USER_ID)  REFERENCES MURICA_USER  (ID) ON DELETE CASCADE ENABLE;

CREATE TABLE MURICA_COURSETEACH
(
    USER_ID CHAR(6) NOT NULL ,
    COURSE_ID CHAR(6) NOT NULL ,
    SUBJECT_ID CHAR(6) NOT NULL
);

ALTER TABLE MURICA_COURSETEACH
    ADD CONSTRAINT MURICA_COURSETEACH_UK1 UNIQUE (USER_ID, COURSE_ID, SUBJECT_ID);

ALTER TABLE MURICA_COURSETEACH
    ADD CONSTRAINT MURICA_COURSETEACH_FK1 FOREIGN KEY(USER_ID)REFERENCES MURICA_USER(ID)ENABLE;

ALTER TABLE MURICA_COURSETEACH
    ADD CONSTRAINT MURICA_COURSETEACH_FK2 FOREIGN KEY( COURSE_ID,  SUBJECT_ID)REFERENCES MURICA_COURSE( ID, SUBJECT_ID )ENABLE;

CREATE TABLE MURICA_TAKEN_COURSE
(
    USER_ID CHAR(6) NOT NULL ,
    PROGRAMME_NAME VARCHAR2(50) NOT NULL ,
    PROGRAMME_TYPE VARCHAR2(10) NOT NULL ,
    COURSE_ID CHAR(6) NOT NULL ,
    SUBJECT_ID CHAR(6) NOT NULL,
    GRADE INT NOT NULL ,
    APPROVED NUMBER(1) NOT NULL
);

ALTER TABLE MURICA_TAKEN_COURSE
    ADD CONSTRAINT MURICA_TAKEN_COURSE_UK1 UNIQUE (USER_ID, PROGRAMME_NAME, PROGRAMME_TYPE, COURSE_ID, SUBJECT_ID);

ALTER TABLE MURICA_TAKEN_COURSE
    ADD CONSTRAINT MURICA_TAKEN_COURSE_FK1 FOREIGN KEY( COURSE_ID,  SUBJECT_ID)REFERENCES MURICA_COURSE( ID, SUBJECT_ID ) ENABLE;

ALTER TABLE MURICA_TAKEN_COURSE
    ADD CONSTRAINT MURICA_TAKEN_COURSE_FK2 FOREIGN KEY
        (
         USER_ID ,
         PROGRAMME_NAME ,
         PROGRAMME_TYPE
            )
        REFERENCES MURICA_STUDENT( USER_ID , PROGRAMME_NAME , PROGRAMME_TYPE )ENABLE;

CREATE TABLE MURICA_TAKEN_EXAM
(
    USER_ID CHAR(6) NOT NULL ,
    PROGRAMME_NAME VARCHAR2(50) NOT NULL ,
    PROGRAMME_TYPE VARCHAR2(10) NOT NULL ,
    EXAM_ID CHAR(6) NOT NULL ,
    SUBJECT_ID CHAR(6) NOT NULL
);

ALTER TABLE MURICA_TAKEN_EXAM
    ADD CONSTRAINT MURICA_TAKEN_EXAM_UK1 UNIQUE (USER_ID, PROGRAMME_NAME, PROGRAMME_TYPE, EXAM_ID, SUBJECT_ID);

ALTER TABLE MURICA_TAKEN_EXAM
    ADD CONSTRAINT MURICA_TAKEN_EXAM_FK1 FOREIGN KEY( USER_ID , PROGRAMME_NAME , PROGRAMME_TYPE )
        REFERENCES MURICA_STUDENT( USER_ID , PROGRAMME_NAME , PROGRAMME_TYPE )ENABLE;

ALTER TABLE MURICA_TAKEN_EXAM
    ADD CONSTRAINT MURICA_TAKEN_EXAM_FK2 FOREIGN KEY( EXAM_ID, SUBJECT_ID)REFERENCES MURICA_EXAM (ID, SUBJECT_ID) ENABLE;

CREATE TABLE MURICA_TOKENS
(
  TOKEN CHAR(36) NOT NULL,
  USER_ID CHAR(6) NOT NULL,
  EXPIRES_AT DATE NOT NULL
);

ALTER TABLE MURICA_TOKENS
ADD CONSTRAINT MURICA_TOKENS_FK1 FOREIGN KEY ( USER_ID )
REFERENCES MURICA_USER ( ID )
ON DELETE CASCADE ENABLE;

INSERT INTO murica_user VALUES ('ADMIN0', 'Admin 1', 'admin1@murica.com', '$2y$10$0oorIkBjl7Ba/XGecVsMi.LGDAHma5DbdqTo41GzURmtiddE4l6jK', TO_DATE('2001-01-01', 'YYYY-MM-DD'));
INSERT INTO murica_user VALUES ('OKTAT1', 'Oktato 2', 'oktato2@murica.com', '$2y$10$YrxcOQ1fIodTO2Gh7r0EF.fQZROeQAuidSc4.ObuNfqLq4g4Ty9j2', TO_DATE('2002-02-02', 'YYYY-MM-DD'));
INSERT INTO murica_user VALUES ('A16BQN', 'Teszt Elek', 'teszt.elek@murica.com', '$2y$10$oMJkEvK5Vq.CH4RJCN7POOdj3kA45Swspq6bZf76dD./3FTv.ESNC', TO_DATE('2003-03-03', 'YYYY-MM-DD'));
INSERT INTO murica_user VALUES ('NPM4AC', 'Proba Odon', 'proba.odon@murica.com', '$2y$10$G6sCKNF9thlgO14iQCNqlulNsKctgX5Sv4ZdqEhUTaiMNshstH9lm', TO_DATE('2004-04-04', 'YYYY-MM-DD'));
INSERT INTO murica_user VALUES ('AX3RW4', 'Elleno Rezso', 'elleno.rezso@murica.com', '$2y$10$od/uWjGQxmCE/fH.hjCNR.COuQbYPqNiYrTzIGqJq2OxcEEQKnUwa', TO_DATE('2005-05-05', 'YYYY-MM-DD'));

INSERT INTO murica_programme VALUES ('Programtervezo informatikus', 'BSc', '6');
INSERT INTO murica_programme VALUES ('Programtervezo informatikus', 'MSc', '4');
INSERT INTO murica_programme VALUES ('Uzemmernok-informatikus', 'BProf', '6');
INSERT INTO murica_programme VALUES ('Gazdasaginformatikus', 'BSc', '7');
INSERT INTO murica_programme VALUES ('Gazdasaginformatikus', 'MSc', '4');

INSERT INTO murica_student VALUES ('A16BQN', 'Programtervezo informatikus', 'BSc', '2020/21/1');
INSERT INTO murica_student VALUES ('A16BQN', 'Programtervezo informatikus', 'MSc', '2023/24/1');
INSERT INTO murica_student VALUES ('NPM4AC', 'Uzemmernok-informatikus', 'BProf', '2021/22/1');
INSERT INTO murica_student VALUES ('AX3RW4', 'Gazdasaginformatikus', 'BSc', '2019/20/1');
INSERT INTO murica_student VALUES ('AX3RW4', 'Gazdasaginformatikus', 'MSc', '2022/23/2');

INSERT INTO murica_admin VALUES ('ADMIN0');

INSERT INTO murica_subject VALUES ('IB042E', 'Digitalis kepfeldolgozas', '0', '2', 'Informatika');
INSERT INTO murica_subject VALUES ('IB403E', 'Formalis nyelvek', '0', '2', 'Informatika');
INSERT INTO murica_subject VALUES ('IB405E', 'Programozasi nyelvek', '1', '3', 'Informatika');
INSERT INTO murica_subject VALUES ('IB714E', 'Webtervezes', '0', '3', 'Informatika');
INSERT INTO murica_subject VALUES ('IB471E', 'Webfejlesztesi keretrendszerek', '0', '2', 'Informatika');
INSERT INTO murica_subject VALUES ('IB471G', 'Webfejlesztesi keretrendszerek', '0', '2', 'Informatika');
INSERT INTO murica_subject VALUES ('MB112E', 'Diszkret matematika', '1', '2', 'Matematika');

INSERT INTO murica_room VALUES ('IR-219', '30');
INSERT INTO murica_room VALUES ('IR-223', '30');
INSERT INTO murica_room VALUES ('IR-222', '25');
INSERT INTO murica_room VALUES ('IR-217', '60');
INSERT INTO murica_room VALUES ('BO-211', '60');

INSERT INTO murica_course VALUES ('IB042E', '1', '30', '1-12:00-14:00', 'OKTAT1', 'IR-219');
INSERT INTO murica_course VALUES ('IB471G', '1', '30', '2-08:00-08:45', 'AX3RW4', 'IR-219');
INSERT INTO murica_course VALUES ('IB471G', '2', '30', '2-09:00-09:45', 'AX3RW4', 'IR-219');
INSERT INTO murica_course VALUES ('IB471G', '3', '30', '3-10:00-10:45', 'AX3RW4', 'IR-219');
INSERT INTO murica_course VALUES ('MB112E', '1', '60', '4-14:00-16:00', 'OKTAT1', 'BO-211');

INSERT INTO murica_exam VALUES ('IB042E', '1', TO_DATE('2024-06-01 12:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2024-06-01 13:30', 'YYYY-MM-DD HH24:MI'), 'OKTAT1', 'BO-211');
INSERT INTO murica_exam VALUES ('IB042E', '2', TO_DATE('2024-06-02 12:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2024-06-02 13:30', 'YYYY-MM-DD HH24:MI'), 'OKTAT1', 'BO-211');
INSERT INTO murica_exam VALUES ('IB042E', '3', TO_DATE('2024-06-03 12:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2024-06-03 13:30', 'YYYY-MM-DD HH24:MI'), 'OKTAT1', 'BO-211');
INSERT INTO murica_exam VALUES ('MB112E', '1', TO_DATE('2024-05-24 14:00', 'YYYY-MM-DD HH24:MI'), TO_DATE('2024-05-24 14:30', 'YYYY-MM-DD HH24:MI'), 'OKTAT1', '');
INSERT INTO murica_exam VALUES ('MB112E', '2', TO_DATE('2024-05-25 16:30', 'YYYY-MM-DD HH24:MI'), TO_DATE('2024-05-25 17:00', 'YYYY-MM-DD HH24:MI'), 'OKTAT1', '');

INSERT INTO MURICA_MESSAGE VALUES (TO_DATE('2024-06-01 12:00', 'YYYY-MM-DD HH24:MI'), 'Uzenet1', 'Test Message 1', 'OKTAT1');
INSERT INTO MURICA_MESSAGE VALUES (TO_DATE('2024-12-11 12:00', 'YYYY-MM-DD HH24:MI'), 'Uzenet2', 'Test Message 2', 'A16BQN');
INSERT INTO MURICA_MESSAGE VALUES (TO_DATE('2024-04-06 12:00', 'YYYY-MM-DD HH24:MI'), 'Uzenet3', 'Test Message 3', 'NPM4AC');
INSERT INTO MURICA_MESSAGE VALUES (TO_DATE('2024-11-03 12:00', 'YYYY-MM-DD HH24:MI'), 'Uzenet4', 'Test Message 4', 'AX3RW4');
INSERT INTO MURICA_MESSAGE VALUES (TO_DATE('2024-05-27 12:00', 'YYYY-MM-DD HH24:MI'), 'Uzenet5', 'Test Message 5', 'ADMIN0');

INSERT INTO MURICA_COURSETEACH VALUES ('OKTAT1', '2','IB471G');
INSERT INTO MURICA_COURSETEACH VALUES ('OKTAT1', '1','IB042E');
INSERT INTO MURICA_COURSETEACH VALUES ('NPM4AC', '1','IB042E');
INSERT INTO MURICA_COURSETEACH VALUES ('A16BQN', '2','IB471G');
INSERT INTO MURICA_COURSETEACH VALUES ('NPM4AC', '1','MB112E');

INSERT INTO MURICA_TAKEN_COURSE VALUES ('A16BQN', 'Programtervezo informatikus', 'BSc', '2','IB471G', 4, 1);
INSERT INTO MURICA_TAKEN_COURSE VALUES ('A16BQN', 'Programtervezo informatikus', 'MSc', '1','IB042E', 5, 0);
INSERT INTO MURICA_TAKEN_COURSE VALUES ('NPM4AC', 'Uzemmernok-informatikus', 'BProf', '1','IB042E', 3, 0);
INSERT INTO MURICA_TAKEN_COURSE VALUES ('AX3RW4', 'Gazdasaginformatikus', 'BSc', '1','MB112E', 4, 0);
INSERT INTO MURICA_TAKEN_COURSE VALUES ('AX3RW4', 'Gazdasaginformatikus', 'MSc', '1','MB112E', 5, 1);

INSERT INTO MURICA_TAKEN_EXAM VALUES ('A16BQN', 'Programtervezo informatikus', 'BSc', '1','IB042E');
INSERT INTO MURICA_TAKEN_EXAM VALUES ('A16BQN', 'Programtervezo informatikus', 'MSc', '2','IB042E');
INSERT INTO MURICA_TAKEN_EXAM VALUES ('NPM4AC', 'Uzemmernok-informatikus', 'BProf', '1','MB112E');
INSERT INTO MURICA_TAKEN_EXAM VALUES ('AX3RW4', 'Gazdasaginformatikus', 'BSc', '2','IB042E');
INSERT INTO MURICA_TAKEN_EXAM VALUES ('AX3RW4', 'Gazdasaginformatikus', 'MSc', '2','MB112E');

INSERT INTO murica_tokens VALUES('48a38d49-143b-4bdf-bd2d-47e255dbbf57', 'ADMIN0', TO_DATE('2024-06-01 13:30', 'YYYY-MM-DD HH24:MI'));
INSERT INTO murica_tokens VALUES('9f4edc47-9fe5-48c5-9402-ae5da616bc4d', 'OKTAT1', TO_DATE('2024-06-01 13:30', 'YYYY-MM-DD HH24:MI'));
INSERT INTO murica_tokens VALUES('2fb15997-1c1c-4d12-aabb-6ee9d2252370', 'A16BQN', TO_DATE('2024-06-01 13:30', 'YYYY-MM-DD HH24:MI'));
INSERT INTO murica_tokens VALUES('1b98c05a-d630-4a6b-b11e-ea763e907f8a', 'NPM4AC', TO_DATE('2024-06-01 13:30', 'YYYY-MM-DD HH24:MI'));
INSERT INTO murica_tokens VALUES('affbdc1a-b73d-4a2d-9ab2-45ee40b5c393', 'AX3RW4', TO_DATE('2024-06-01 13:30', 'YYYY-MM-DD HH24:MI'));
